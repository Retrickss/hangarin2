{% extends 'base.html' %}
{% block title %}Dashboard | Hangarin{% endblock %}
{% block content %}

<div class="container-fluid py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold mb-0">Welcome back ðŸ‘‹</h2>
      <small class="text-muted">Today is {{ today|date:"l, F j, Y" }}</small>
    </div>
  </div>

  <!-- Stats cards -->
  <div class="row g-4">

    <!-- Total -->
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-lg rounded-4 p-3 bg-primary text-white">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="text-uppercase mb-1 small fw-semibold">Total Tasks</p>
            <h3 class="fw-bold mb-0">{{ total_tasks }}</h3>
          </div>
          <div class="icon bg-white bg-opacity-25 p-3 rounded-circle">
            <i class="bi bi-list-task fs-4"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Pending -->
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-lg rounded-4 p-3 bg-warning text-dark">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="text-uppercase mb-1 small fw-semibold">Pending</p>
            <h3 class="fw-bold mb-0">{{ pending_tasks }}</h3>
          </div>
          <div class="icon bg-white bg-opacity-25 p-3 rounded-circle">
            <i class="bi bi-hourglass-split fs-4"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- In Progress -->
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-lg rounded-4 p-3 bg-info text-white">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="text-uppercase mb-1 small fw-semibold">In Progress</p>
            <h3 class="fw-bold mb-0">{{ in_progress_tasks }}</h3>
          </div>
          <div class="icon bg-white bg-opacity-25 p-3 rounded-circle">
            <i class="bi bi-arrow-repeat fs-4"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Completed -->
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-lg rounded-4 p-3 bg-success text-white">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="text-uppercase mb-1 small fw-semibold">Completed</p>
            <h3 class="fw-bold mb-0">{{ completed_tasks }}</h3>
          </div>
          <div class="icon bg-white bg-opacity-25 p-3 rounded-circle">
            <i class="bi bi-check-circle fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Progress bar -->
  <div class="card border-0 shadow-lg rounded-4 p-4 mt-4">
    <h5 class="fw-bold mb-3"><i class="bi bi-graph-up-arrow me-2 text-primary"></i>Task Status Overview</h5>

    {% if total_tasks > 0 %}
      {% widthratio pending_tasks total_tasks 100 as pending_percent %}
      {% widthratio in_progress_tasks total_tasks 100 as progress_percent %}
      {% widthratio completed_tasks total_tasks 100 as complete_percent %}
    {% else %}
      {% with 0 as pending_percent %}
      {% with 0 as progress_percent %}
      {% with 0 as complete_percent %}
      {% endwith %}
      {% endwith %}
      {% endwith %}
    {% endif %}

    
    <div class="d-flex justify-content-between small text-muted">
      <span>Pending: {{ pending_percent }}%</span>
      <span>In Progress: {{ progress_percent }}%</span>
      <span>Completed: {{ complete_percent }}%</span>
    </div>
  </div>

  <!-- Recent tasks -->
  <div class="card border-0 shadow-lg rounded-4 p-4 mt-4">
    <h5 class="fw-bold mb-3"><i class="bi bi-clock-history me-2 text-primary"></i>Recent Updates</h5>

    <div class="table-responsive">
      <table class="table align-middle table-hover">
        <thead class="table-light">
          <tr>
            <th>Task</th>
            <th>Status</th>
            <th>Category</th>
            <th>Priority</th>
            <th>Updated</th>
          </tr>
        </thead>
        <tbody>
          {% for task in recent_tasks %}
          <tr>
            <td class="fw-semibold">{{ task.title }}</td>
            <td>
              {% if task.status == 'Pending' %}
                <span class="badge bg-warning text-dark">Pending</span>
              {% elif task.status == 'In Progress' %}
                <span class="badge bg-info">In Progress</span>
              {% else %}
                <span class="badge bg-success">Completed</span>
              {% endif %}
            </td>
            <td>{{ task.category.name|default:"â€”" }}</td>
            <td>{{ task.priority.name|default:"â€”" }}</td>
            <td>{{ task.updated_at|date:"M d, Y" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center text-muted py-3">No recent updates.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>

<style>
  .progress-bar { transition: width 0.6s ease; }
  .card .icon i { color: #fff; }
</style>

{% endblock %}
